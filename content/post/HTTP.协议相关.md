+++
date = "2016-12-11T22:07:46+08:00"
title = "HTTP.协议相关"
draft = false
tags = ["整理","HTTP"]
share = true
+++

[TOC]

## 参考
- [Http 协议详解](http://kb.cnblogs.com/page/130970/)
- [HTTP headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)
- [Hypertext Transfer Protocol -- HTTP/1.1](https://www.w3.org/Protocols/rfc2616/rfc2616.html)
- [四种常见的 POST 提交数据方式](https://imququ.com/post/four-ways-to-post-data-in-http.html)
- [Http.vary](https://imququ.com/post/vary-header-in-http.html)


## Http.detail
- Message Body 消息体
- Request  请求头
- ```
POST http://dev-p.yunkai.com/api/resource/upload HTTP/1.1
```
- Header  头文件
- ```
Accept: application/json, text/plain, */*
Content-Type: multipart/form-data; boundary=---------------------------7e016f3be0a4a
Referer: http://dev-p.yunkai.com/admin/index.html#/meetings/98/update/agendas
Accept-Language: zh-Hans-CN,zh-Hans;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko
Content-Length: 4708261
Host: dev-p.yunkai.com
Connection: Keep-Alive
Pragma: no-cache
Cookie: SESSION=82526c96-4740-4d52-b3c1-757384ba3017
```
- Empty line
- Body  消息体
- ```
-----------------------------7e016f3be0a4a
Content-Disposition: form-data; name="file"; filename="B2283659A4B9302BE09FE2EC97690382.pptx"
Content-Type: application/vnd.openxmlformats-officedocument.presentationml.presentation
```
- Method
- GET
- Data.length.limit
- Browser
- IE:  2083B= 2KB+ 35B  
- Firefox:  65,536 Char -> 1 Char= 2B
- Safari:  80,000 Char
- Opera:  190,000 Char
- Chrome:  8,182 Char
- Server
- Apache:  8,192 Char
- IIS:  16,384 Char
- POST
- Data.length.limit
- Http not set the limit
- Apache.Tomcat.default.maxPostSize= 2M
- HEAD
- TRACE
- PUT
- DELETE
- OPTION
- CONNECT


## Status Code
### [Http Status code](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)
- 参考
- http://www.cnblogs.com/DeasonGuan/articles/Hanami.html
- http://www.cnblogs.com/shanyou/archive/2012/05/06/2486134.html

- 1XX - Informational 
- define: provisional response, consisting only of the status-line and optional headers, and is terminated by an empty line. expect for proxy
- list
- 100 - Continue: **continue** the request
- 101 - Switching Protocols: terminate the 101 response after the empty line then **change the application protocol**
- 2XX - Successful
- define: client's request was successfully received, understood and accepted
- list
- 200 - OK: the request has **succeeded**
- 201 - Created: new resource **created immediately**
- 202 - Accepted: has been **accepted** but **not completed**
- 203 - Non-Authoritative Information: may fathered from a local or a **third-party copy**
- 204 - No Content: not need to return an entity-body, just like update method, and **MUST NOT include an entity**
- 205 - Reset Content: reset the form and **MUST NOT include an entity**
- 206 - Partial content:for download big data and **MUST have a range header**, and **MUST NOT include other entity**

- 3XX - Redirection
- define: further action needs to be taken by the user agent, detect infinite redirection loops
- list
- 300 - Multiple Choices: select a preferred representation from a set of them
- 301 - Moved Permanently: **other than GET/ HEAD**, NUST NOT automatically **redirect** to an new permanent URI
- 302 - Found: redirect to a different URI on occasion, and only cacheable by Cache-control or Expires header
- 303 - See Other: SHOULD **retrieved different URI using a GET method**,  user HEAD to get the new URI from the short hypertext note with a hyperlink
- 304 - Not Modified: the document has not been modified, the server **MUST NOT contain a message-body**, thus always terminated by the first empty line after the header fields
- 305 - Use Proxy: generated by origin servers, and **MUST accessed through the proxy**, or notice the client to repeat request via the proxy
- 306 : Unused 
- 307 - Temporary Redirect: resource **resieds temporarily on occasion**, and the client **SHOULD continue use the Request-URI** for future requests

- 4XX - Client Error
- define: for cases in which the client seems to have erroed
- list
- 400 - Bad Request: the request could not be understood
- 401 - Unauthorized: the request requires user authentication, **MUST inclued a WWW-Authenticate header field**
- 402 - Payment Required: reserved for future use
- 403 - Forbidden: the server understood the request, but is **refusing** to fulfill it
- 404 - Not Found: the server has not found anything matching the Request-URI
- 405 - Method Not Allowed: specified in the request-line is not allowed
- 406 - Not Acceptable: the **content characteristics of the request is not acceptable**.  while HEAD request, the response SHOULD include an entity containing a list of available entity characteristics and location
- 407 - Proxy Authentication Required: similar to 401, but indicates that the client **must first authenticate itself with the poxy**
- 408 - Request Timeout: no produce a request with the time
- 409 - Conflict: conflict with the current state of resource. the body include the conflict info and expect the client 
- 410 - Gone: the requested **resource** is **no longer available**
- 411 - Length Required: the **Content-length** header of the request is not enought
- 412 - Precondition Failed: one or more of the **request-header fields evaluated to false**
- 413 - Request Entity Too Large: the server resusing to process the request because **the request entity is larger than** the server is **willing or able to process**
- 414 - Request-URI Too Long
- 415 - Unsupported Media Type:
- 416 - Requested Range Not Satisfiable: the request included a Range request-header and the byte-ranges is out of array
- 417 - Expectation Failed: expect request-header field could not be met

- 5XX - Server Error
- list
- 500 - Internal Server Error: the server encountered an unexpected condition
- 501 - Not Implemented: the server does not support 
- 502 - Bad Gateway: the server, while acting as a gateway or proxy, received an invalid response from the upstream server
- 503 - Service Unavailable: unable to handle the request due to **a temporary overloading or maintenance of the server**, temporary status
- 504 - Gateway Timeout: acting as a gateway or proxy, could not receive the timely response from the upstream server 
- 505 - HTTP Version Not Supported: the HTTP protocol version was used is not supported in the server


## Header.request
- Cache
- If-Modified-Since
- 与 Last-Modified 配合使用，进行缓存读取或新文件获取
- If-None-Match
- 与 ETags 配合使用，进行缓存读取或新文件获取
- [Cache-Control](http://stackoverflow.com/questions/3492319/private-vs-public-in-cache-control)
- Public: cache by client and proxy
- Private: default, only cache by client
- no-cache: no cache
- Pragma: no-cache，同 Cache-Control: no-cache

- Client
- Accept
- lists the MIME types expected by the user agent
- example
- Accept: audio/*; q=0.2, audio/basic
- I prefer audio/basic, but send me any audio type if it is the best available after an 80% mark-down in quality
- Accept: text/plain; q=0.5, text/html, text/x-dvi; q=0.8, text/x-c
- text/html and text/x-c are the preferred media types, but if they do not exist, then send the text/x-dvi entity, and if that does not exist, send the text/plain entity
- Accept-Encoding
- lists the compression methods supported by the user agent
- example
        - Accept-Encoding: compress, gzip
        - Accept-Encoding:
        - Accept-Encoding: *
        - Accept-Encoding: compress;q=0.5, gzip;q=1.0
        - Accept-Encoding: gzip;q=1.0, identity; q=0.5, *;q=0
- Accept-Language
- lists the languages the user agent expect the page in
- example
- Accept-Language: da, en-gb;q=0.8, en;q=0.7
- I prefer Danish, but will accept British English and other types of English
- User-Agent
- list the name and version of client system and browser
- example
- User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; CIBA; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; InfoPath.2; .NET4.0E)
- Accept-Charset
- lists the character sets supported by the user agent
- example
- Accept-Charset: iso-8859-5, unicode-1-1;q=0.8
- if server cannot response, it will response 406 error

- Cookies/ Login
- Cookie

- Entity
- Content-Length
- Content-Type
- Choice
- application/x-www-form-urlencoded 
- 默认方式
- 提交数据以 key1=val1&key2=val2 形式编码，且 key/ val 均进行了 URL 转码
- multipart/form-data
- 主要用于文件上传
- application/json
- 指定消息主体为 Json 字符串
- text/xml
- HTTP 作为传输协议， XML 作为编码方式的远程调用规范
- example
- Content-Type: application/x-www-form-urlencoded

- Miscellaneous
- Referer
- special the resource from 
- example
- Referer:http://translate.google.cn/?hl=zh-cn&tab=wT

- Transport
- Connection
- keep-alive
- http 1.0 默认关闭， http 1.1中默认启用Keep-Alive
- 判断消息长度
- Conent-Length
- Transfer-Encoding: chunked
- 由 length=0 的 chunk 标示结束
- chunk= header+ content [+ CRLF-回车换行分享]
- header: 0xContent.length [unit]
- content
- close
- Host
- specifies the Internet host and port number of the resource being requested
- example
- http://www.guet.edu.cn/index.html -> host= www.guet.edu.cn
- http://192.168.70.198:8080/api/resource/upload  -> host= 192.168.70.198:8080


## Header.response
- Cache
- Date
- represents the date and time at which the message was originated
- example
- Date: Tue, 15 Nov 1994 08:12:31 GMT
- Expires
- use cache before expire
- RFC 1123 date format
- example
- Expires: Thu, 01 Dec 1994 16:00:00 GMT
- Vary
- the Vary field value advises the user agent about the criteria that were used to select the representation
- example
- Vary: User-Agent, Cookie
- Vary 字段用于列出一个响应字段列表，告诉缓存服务器遇到同一个 URL 对应着不同版本文档的情况时，如何缓存和筛选合适的版本。

- Cookie/ Login
- P3P
- 用于跨域设置Cookie, 可解决iframe跨域访问cookie的问题
- example
- P3P: CP=CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR
- Set-Cookie
- 更新客户端浏览器 Cookie 信息
- example
- Set-Cookie: sc=4c31523a; path=/; domain=.acookie.taobao.com

- Entity
- Etag
- Last-Modified
- 参考 If-Modified-Since
- Content-Type
- Content-Length
- Content-Encoding
- Content-Language

- Miscellaneous
- Server
- 指明 Http 服务器软件信息
- example
- Server: Microsoft-IIS/7.5
- X-AspNet-Version
- 指明 ASP.NET 版本
- example
- X-AspNet-Version: 4.0.30319
- X-Powered-By
- 指明开发技术
- example
- X-Powered-By: ASP.NET

- Transport
- Connection

- Location
- Location
- 重定向，包含 URL 地址


## Other
### [缓存](http://www.cnblogs.com/lyzg/p/5125934.html)
- 分类
- 强缓存
- 判断命中，则直接从浏览器缓存中读取资源，不发请求至服务器（200）
- 协商缓存
- 发请求至服务器，协商缓存命中，则返回请求（304），告知浏览器从缓存中加载
- 实现
- 强缓存
- 请求资源时，资源及其 response header 一并被缓存
- 再次请求时，优先比对该资源 header 中的 
- Expries（失效时间）
- 或 Cache-Control：max-age=315360000 & Date: Mon, 11 Jan 2016 06:41:22 GMT
- 对比判断是否命中
- **注：Cache-Control 为相对时间，都使用客户端时间进行判断，相比 Expries 的服务器时间对比更安全。**
- 协商缓存
- 请求资源时，资源及其 response header 一并被缓存
- 再次和服务器请求该请求时，一并传上 
- header.Last-Modified: Tue 12 Jan 2016 03:08:53 GMT  - 服务器上该资源的最后修改时间
- header.If-Modified-Since: Tue 12 Jan 2016 03:08:53 GMT  - 上一次浏览器请求时返回的 Last-Modified 值
- 或 ETag: "17fd8-5291a5f96fd20" - 请求资源的唯一标识
- If-None-Match: "17fd8-5291a5f96fd20" - 上一次请求时的 ETag 值

