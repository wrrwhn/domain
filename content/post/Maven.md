+++
date = "2016-12-09T22:07:46+08:00"
title = "Maven"
draft = false
tags = ["整理","Maven"]
share = true
+++

[TOC]

## 部署安装
### 下载地址
- http://maven.apache.org/download.cgi

### 安装流程
- 至下载地址下载最新版本Maven压缩包
- 解压至本地文件路径
- 补充环境变量
    - [M2_HOME: C:\Program Files\Apache Software Foundation\apache-maven-3.2.2]
    - [M2:  %M2_HOME%\bin]
    - [MAVEN_OPTS: -Xms256m -Xmx512m]
    - 并于最后于path变量里补充%M2%;
- 控制台输出 mvn -version，若有相关输出则表示安装成功


## [生命周期 ](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)
### 内置构建：
- default：处理项目部署
- clean：清理项目
- site：创建项目的网站文件
### 各生命周期执行内容：
#### Clean Lifecycle
- pre-clean    executes processes needed prior to the actual project cleaning
- clean    remove all files generated by the previous build
- post-clean    executes processes needed to finalize the project cleaning
#### Default Lifecycle
- validate    validate the project is correct and all necessary information is available.
- initialize    initialize build state, e.g. set properties or create directories.
- generate-sources    generate any source code for inclusion in compilation.
- process-sources    process the source code, for example to filter any values.
- generate-resources    generate resources for inclusion in the package.
- process-resources    copy and process the resources into the destination directory, ready for packaging.
- compile    compile the source code of the project.
- process-classes    post-process the generated files from compilation, for example to do bytecode enhancement on Java classes.
- generate-test-sources    generate any test source code for inclusion in compilation.
- process-test-sources    process the test source code, for example to filter any values.
- generate-test-resources    create resources for testing.
- process-test-resources    copy and process the resources into the test destination directory.
- test-compile    compile the test source code into the test destination directory
- process-test-classes    post-process the generated files from test compilation, for example to do bytecode enhancement on Java classes. For Maven 2.0.5 and above.
- test    run tests using a suitable unit testing framework. These tests should not require the code be packaged or deployed.
- prepare-package    perform any operations necessary to prepare a package before the actual packaging. This often results in an unpacked, processed version of the package. (Maven 2.1 and above)
- package    take the compiled code and package it in its distributable format, such as a JAR.
- pre-integration-test    perform actions required before integration tests are executed. This may involve things such as setting up the required environment.
- integration-test    process and deploy the package if necessary into an environment where integration tests can be run.
- post-integration-test    perform actions required after integration tests have been executed. This may including cleaning up the environment.
- verify    run any checks to verify the package is valid and meets quality criteria.
- install    install the package into the local repository, for use as a dependency in other projects locally.
- deploy    done in an integration or release environment, copies the final package to the remote repository for sharing with other developers and projects.   
#### Site Lifecycle
- pre-site    executes processes needed prior to the actual project site generation
- site    generates the project's site documentation
- post-site    executes processes needed to finalize the site generation, and to prepare for site deployment
- site-deploy    deploys the generated site documentation to the specified web server

### 调用
#### 如调用deploy(mvn deploy)便会自动调用前面的几个流程步骤
#### 仍可在同一指令中调用多个操作（多模块场景中会自动递归至各子模块），如 mvn clean install
#### 相关指令
- Clean Lifecycle Bindings
    - clean    clean:clean

- Default Lifecycle Bindings - Packaging ejb / ejb3 / jar / par / rar / war
    - process-resources    resources:resources
    - compile    compiler:compile
    - process-test-resources    resources:testResources
    - test-compile    compiler:testCompile
    - test    surefire:test
    - package    ejb:ejb or ejb3:ejb3 or jar:jar or par:par or rar:rar or war:war
    - install    install:install
    - deploy    deploy:deploy
- Default Lifecycle Bindings - Packaging ear
    - generate-resources    ear:generate-application-xml
    - process-resources    resources:resources
    - package    ear:ear
    - install    install:install
    - deploy    deploy:deploy
- Default Lifecycle Bindings - Packaging maven-plugin
    - generate-resources    plugin:descriptor
    - process-resources    resources:resources
    - compile    compiler:compile
    - process-test-resources    resources:testResources
    - test-compile    compiler:testCompile
    - test    surefire:test
    - package    jar:jar and plugin:addPluginArtifactMetadata
    - install    install:install
    - deploy    deploy:deploy
- Default Lifecycle Bindings - Packaging pom
    - package    site:attach-descriptor
    - install    install:install
    - deploy    deploy:deploy
- Site Lifecycle Bindings
    - site    site:site
    - site-deploy    site:deploy

### 初始化
#### POM文件中补充<packaging>节点，默认值为jar，可选值为jar/war/ear/pom
#### jar方式流程
- process-resources    resources:resources
- compile    compiler:compile
- process-test-resources    resources:testResources
- test-compile    compiler:testCompile
- test    surefire:test
- package    jar:jar
- install    install:install
- deploy    deploy:deploy
#### 使用Plugins来实现各环节的操作步骤，其中若同一环节有多个插件支持，则以POM文件顺序下的第一个进行处理
```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-checkstyle-plugin</artifactId>
    <version>${plugin.checkstyle.version}</version>
    <configuration>
        <configLocation>${project.basedir}/build/check-style.xml</configLocation>
        <includeTestSourceDirectory>false</includeTestSourceDirectory>
        <consoleOutput>true</consoleOutput>
        <failsOnError>true</failsOnError>
    </configuration>
    <executions>
        <execution>
            <phase>verify</phase>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```


## [POM.XML详解](http://blog.csdn.net/zhuxinhua/article/details/5788546)
### 作用
- 描述项目如下内容：包括配置文件；开发者需要遵循的规则，缺陷管理系统，组织和licenses，项目的url，项目的依赖性，以及其他所有的项目相关因素。
### 结构
```
<project>
    <modelVersion>4.0.0</modelVersion>
    <!-- 基础设置 -->
    <groupId>项目或者组织的唯一标志，也将会是配置生成路径</groupId>
    <artifactId>项目名称</artifactId>
    <version>版本</version>
    <packaging>打包机制，支持pom,jar,maven-plugin,ejb,war,ear,rar,par</packaging>
    <name>用户描述项目名称，可选</name>
    <url>开发团队网站，可选</url>
    <dependencies>
        <!-- 依赖 -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.0</version>
            <type>默认 jar，常用类型有 jar,ejb-client,test-jar</type>
            <scope>
                compile     缺省值，适用于所有阶段，会随着项目一起发布。
                provided     类似compile，期望JDK、容器或使用者会提供这个依赖。如servlet.jar。
                runtime     只在运行时使用，如JDBC驱动，适用运行和测试阶段。
                test         只在测试时使用，用于编译和运行测试代码。不会随项目发布。
                system         类似provided，需要显式提供包含依赖的jar，Maven不会在Repository中查找它。
            </scope>
            <optional>
                默认为 false，即子项目默认继承。为 true时则子项目必须显示引入。
            </optional>
        </dependency>
        <dependency>
            <groupId>com.alibaba.china.shared</groupId>
            <artifactId>alibaba.apollo.webx</artifactId>
            <version>2.5.0</version>
            <exclusions>
                <exclusion>        <!-- 移除指定依赖 -->
                    <groupId>com.alibaba.external</groupId>
                    <artifactId>org.slf4j.slf4j-api</artifactId>
                </exclusion>
                ....
            </exclusions>
    </dependencies>
    <!-- 工程为 parent 时，packing 参数值需为 pom，则子项目可继承 dependencies,developers,contributors,plugin lists,reports lists,plugin execution with matching ids,plugin configuration -->
    <parent>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>my-parent</artifactId>
        <version>2.0</version>
        <relativePath>../my-parent</relativePath>
    </parent>
    <dependencyManagement>
        用于帮助管理子项目的依赖，子项目的相关引用 version 将由父项目进行设置
    </dependencyManagement>
    <modules> 与顺序无关，maven 会自动根据依赖关系拓扑排序 </modules>

    <!-- 配置常量，并于 pom 其它地方以 ${file.encoding} 形式调用  -->
    <properties>
        <file.encoding>UTF-8</file_encoding>
    </properties>
    <!--构建设置 -->
    <build>...</build>
    <reporting>...</reporting>
    <!-- 更多项目信息 -->
    <description>...</description>
    <inceptionYear>...</inceptionYear>
    <licenses>...</licenses>
    <organization>...</organization>
    <developers>...</developers>
    <contributors>...</contributors>
    <!-- 环境设置-->
    <issueManagement>...</issueManagement>
    <ciManagement>...</ciManagement>
    <mailingLists>...</mailingLists>
    <scm>...</scm>
    <prerequisites>...</prerequisites>
    <repositories>...</repositories>
    <pluginRepositories>...</pluginRepositories>
    <distributionManagement>...</distributionManagement>
    <profiles>...</profiles>
</project>
```


## 示例
### 外部 Jar 引入本地项目System
- 相对引用
```
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>aliyun-java-sdk-dysmsapi</artifactId>
    <version>1.0.0</version>
    <scope>system</scope>
    <systemPath>${basedir}/src/main/lib/aliyun-java-sdk-dysmsapi-1.0.0.jar</systemPath>
</dependency>
```
- 打包时包括在内
```
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-dependency-plugin</artifactId>
    <version>2.10</version>
    <executions>
        <execution>
            <id>copy-dependencies</id>
            <phase>compile</phase>
            <goals>
                <goal>copy-dependencies</goal>
            </goals>
            <configuration>
                <outputDirectory>${project.build.directory}/${project.build.finalName}/WEB-INF/lib</outputDirectory>
                <includeScope>system</includeScope>
            </configuration>
        </execution>
    </executions>
</plugin>
```
