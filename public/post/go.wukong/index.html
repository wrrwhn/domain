<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>READ FROM LIFE</title>
        <meta name="author">
        <meta name="description" content="姚清居到此一游">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.30.2" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="alternate" type="application/rss+xml" title="READ FROM LIFE" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="feed" type="application/rss+xml" title="READ FROM LIFE" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/styles.css">
        <link rel="icon" href="http://domain.yqjdcyy.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://domain.yqjdcyy.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/highlightjs/monokai.css">
        <script src="http://domain.yqjdcyy.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://domain.yqjdcyy.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2></h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://domain.yqjdcyy.com/" title="">&laquo; </a>
            
<h1><a href="http://domain.yqjdcyy.com/post/go.wukong/" title="Go.Wukong">Go.Wukong</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2017.11.15">2017.11.15</time>

    &middot; 
        
        <a href="http://domain.yqjdcyy.com/tags/%E6%95%B4%E7%90%86">整理</a>, 
        
        <a href="http://domain.yqjdcyy.com/tags/go">go</a>, 
        
        <a href="http://domain.yqjdcyy.com/tags/%E6%9F%A2">柢</a>
        
    

</span>
</footer>

            

<p>[TOC]</p>

<h1 id="悟空引擎使用">悟空引擎使用</h1>

<h2 id="参考">参考</h2>

<ul>
<li><a href="http://tonybai.com/2016/12/06/an-intro-to-wukong-fulltext-search-engine/">使用wukong全文搜索引擎</a></li>
<li><a href="https://github.com/huichen/wukong">huichen/wukong</a></li>
<li><a href="http://www.infoq.com/cn/news/2015/09/wukong-search-engine">悟空：用Go语言编写的全文搜索引擎</a></li>
<li><a href="https://github.com/huichen/sego">huichen/sego</a></li>
<li><a href="https://github.com/boltdb/bolt">boltdb/bolt</a></li>
<li><a href="https://github.com/cznic/kv">cznic/kv</a></li>
<li><a href="https://github.com/huichen/murmur">huichen/murmur</a></li>
</ul>

<h2 id="介绍">介绍</h2>

<h3 id="内部结构">内部结构</h3>

<ul>
<li>主协程，用于收发用户请求</li>
<li>分词器（segmenter）协程，负责分词</li>
<li>索引器（indexer）协程，负责建立和查找索引表</li>
<li>排序器（ranker）协程，负责对文档评分排序</li>
</ul>

<h3 id="流程">流程</h3>

<h4 id="索引">索引</h4>

<ul>
<li>文档加入索引请求</li>
<li>主协程通过 channel 将分要分词的文本发送给分词协程</li>
<li>该协程将文本分词后通过另一信道发送给索引器协程</li>
<li>索引器协程建立从搜索键到文档的反向索引，并保存在内存中</li>
</ul>

<h4 id="搜索">搜索</h4>

<ul>
<li>主协程获取用户搜索请求，将搜索词分词后通过信道传递给索引器</li>
<li>索引器查找每个搜索键对应文档，并进行逻辑归并求交集后，得到精简文档列表，并通过信道传递给排序器</li>
<li>排序器对文档进行评分、筛选和排序，并通过指定信道返回主协程以返回给用户</li>
</ul>

<h2 id="结构">结构</h2>

<ul>
<li>core</li>
<li>data</li>
<li>docs</li>
<li>engine</li>
<li>example</li>
<li>storate</li>
<li>testdata</li>
<li>types</li>
<li>utils</li>
</ul>

<h2 id="使用">使用</h2>

<ul>
<li><p>基本</p>

<pre><code>searcher = engine.Engine{}

searcher.Init(types.EngineInitOptions{
        IndexerInitOptions: &amp;types.IndexerInitOptions{
            IndexType: types.DocIdsIndex,
        },
        SegmenterDictionaries: &quot;./dict/dictionary.txt&quot;,
        StopTokenFile:         &quot;./dict/stop_tokens.txt&quot;,
    })
defer searcher.Close()
searcher.IndexDocument(docId, types.DocumentIndexData{Content: text1}, false)
searcher.FlushIndex()
fmt.Printf(&quot;%#v\n&quot;, searcher.Search(types.SearchRequest{Text: &quot;巴萨 梅西&quot;}))
</code></pre></li>

<li><p>序列类型</p>

<ul>
<li>FrequenciesIndex

<ul>
<li>保留词频</li>
<li><code>types.SearchResponse{Tokens:[]string{&quot;巴萨&quot;, &quot;梅西&quot;}, Docs:[]types.ScoredDocument{types.ScoredDocument{DocId:0x1, Scores:[]float32{3.0480049}, TokenSnippetLocations:[]int(nil), TokenLocations:[][]int(nil)}}, Timeout:false, NumDocs:1}</code></li>
</ul></li>
<li>LocationsIndex

<ul>
<li>保留关键字在文档中出现的位置信息</li>
<li><code>types.SearchResponse{Tokens:[]string{&quot;巴萨&quot;, &quot;梅西&quot;}, Docs:[]types.ScoredDocument{types.ScoredDocument{DocId:0x1, Scores:[]float32{3.0480049}, TokenSnippetLocations:[]int{37, 76}, TokenLocations:[][]int{[]int{37}, []int{76}}}}, Timeout:false, NumDocs:1}</code></li>
</ul></li>
</ul></li>

<li><p>分词</p>

<ul>
<li>中文分词基于 <code>sego</code> 项目实现</li>
<li>分词准确度影响索引建立和关键词搜索，建议定期更新网络库</li>
</ul></li>

<li><p>持久化索引+启动恢复</p>

<ul>
<li>文档索引存放在内存中</li>
<li>持久化方式

<ul>
<li>boltdb

<ul>
<li>默认</li>
<li>An embedded key/value database for Go.</li>
</ul></li>
<li>cznic/kv

<ul>
<li>Package kv implements a simple and easy to use persistent key/value (KV) store.</li>
</ul></li>
</ul></li>
<li>示例
<code>
searcher.Init(types.EngineInitOptions{
       IndexerInitOptions: &amp;types.IndexerInitOptions{
           IndexType: types.DocIdsIndex,
       },
       UsePersistentStorage:    true,
       PersistentStorageFolder: &quot;./index&quot;,
       SegmenterDictionaries:   &quot;./dict/dictionary.txt&quot;,
       StopTokenFile:           &quot;./dict/stop_tokens.txt&quot;,
   })
   // ＊
searcher.FlushIndex()
</code></li>
</ul></li>

<li><p>分布式</p>

<ul>
<li>按文本内容 hash 值理解试用分至不同服务器索引</li>
<li>请求时分发至所有裂分服务器，后将所有服务器返回结果归并排序后输出</li>
<li>使用 Murmur3 hash 来保证裂分均匀性</li>
</ul></li>
</ul>

<h2 id="局限">局限</h2>

<ul>
<li>作者个人项目，资料少，开发不活跃</li>
<li>缺少开发计划和愿景</li>
<li>查询功能简单，仅支持关键词的 AND 操作</li>
<li>缺少将索引存储于 DB 的操作支持</li>
</ul>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fgo.wukong%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Go.Wukong&amp;url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fgo.wukong%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fgo.wukong%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fgo.wukong%2f&title=Go.Wukong" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yqjdcyy-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
    </main>
    <aside class="author">
  <img class="profile-image" src="http://domain.yqjdcyy.com/img/profile-image.png" alt="姚清居" />
  <p class="name"> 
  <strong>姚清居</strong></p>
  <p class="address">Earth</p>
  <p class="link"></p>
  <ul class="social">
    












<li><a href="//github.com/wrrwhn" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://domain.yqjdcyy.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://domain.yqjdcyy.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2018 &middot; Powered by <a href="http://www.yqjdcyy.com">姚清居</a>.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/domain.yqjdcyy.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://domain.yqjdcyy.com/js/plugins.js"></script>




</body>
</html>

