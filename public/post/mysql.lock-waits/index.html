<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>好久不见</title>
        <meta name="author">
        <meta name="description" content="好久不见">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.30.2" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="alternate" type="application/rss+xml" title="好久不见" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="feed" type="application/rss+xml" title="好久不见" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/styles.css">
        <link rel="icon" href="http://domain.yqjdcyy.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://domain.yqjdcyy.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/highlightjs/monokai.css">
        <script src="http://domain.yqjdcyy.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://domain.yqjdcyy.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2></h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://domain.yqjdcyy.com/" title="">&laquo; </a>
            
<h1><a href="http://domain.yqjdcyy.com/post/mysql.lock-waits/" title="MYSQL.LOCK-WAITS">MYSQL.LOCK-WAITS</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2017.04.23">2017.04.23</time>

    &middot; 
        
        <a href="http://domain.yqjdcyy.com/tags/%E6%95%B4%E7%90%86">整理</a>, 
        
        <a href="http://domain.yqjdcyy.com/tags/mysql">mysql</a>
        
    

</span>
</footer>

            

<p>[TOC]</p>

<h1 id="mysql-5-5-innodb-锁等待-https-dbarobin-com-2015-01-27-innodb-lock-wait-under-mysql-5-5"><a href="https://dbarobin.com/2015/01/27/innodb-lock-wait-under-mysql-5.5/">MySQL 5.5 InnoDB 锁等待</a></h1>

<h2 id="锁相关表">锁相关表</h2>

<table>
<thead>
<tr>
<th>表名</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>innodb_trx</td>
<td>当前正在执行事务的信息</td>
</tr>

<tr>
<td>innodb_locks</td>
<td>各已被请求但未被提交的事务锁</td>
</tr>

<tr>
<td>innodb_lock_waits</td>
<td>各阻塞事务的一至多行记录信息</td>
</tr>
</tbody>
</table>

<h2 id="字段">字段</h2>

<h3 id="innodb-trx">innodb_trx</h3>

<table>
<thead>
<tr>
<th>字段</th>
<th>注释</th>
</tr>
</thead>

<tbody>
<tr>
<td>trx_id</td>
<td>事务ID。</td>
</tr>

<tr>
<td>trx_state</td>
<td>事务状态，有以下几种状态:RUNNING、LOCK WAIT、ROLLING BACK 和 COMMITTING。</td>
</tr>

<tr>
<td>trx_started</td>
<td>事务开始时间。</td>
</tr>

<tr>
<td>trx_requested_lock_id</td>
<td>事务当前正在等待锁的标识，可以和 INNODB_LOCKS 表 JOIN 以得到更多详细信息。</td>
</tr>

<tr>
<td>trx_wait_started</td>
<td>事务开始等待的时间。</td>
</tr>

<tr>
<td>trx_weight</td>
<td>事务的权重。</td>
</tr>

<tr>
<td><strong>trx_mysql_thread_id</strong></td>
<td>事务线程 ID，可以和 PROCESSLIST 表 JOIN。</td>
</tr>

<tr>
<td><strong>trx_query</strong></td>
<td>事务正在执行的 SQL 语句。</td>
</tr>

<tr>
<td>trx_operation_state</td>
<td>事务当前操作状态。</td>
</tr>

<tr>
<td>trx_tables_in_use</td>
<td>当前事务执行的 SQL 中使用的表的个数。</td>
</tr>

<tr>
<td>trx_tables_locked</td>
<td>当前执行 SQL 的行锁数量。</td>
</tr>

<tr>
<td>trx_lock_structs</td>
<td>事务保留的锁数量。</td>
</tr>

<tr>
<td>trx_lock_memory_bytes</td>
<td>事务锁住的内存大小，单位为 BYTES。</td>
</tr>

<tr>
<td>trx_rows_locked</td>
<td>事务锁住的记录数。包含标记为 DELETED，并且已经保存到磁盘但对事务不可见的行。</td>
</tr>

<tr>
<td>trx_rows_modified</td>
<td>事务更改的行数。</td>
</tr>

<tr>
<td>trx_concurrency_tickets</td>
<td>事务并发票数。</td>
</tr>

<tr>
<td>trx_isolation_level</td>
<td>当前事务的隔离级别。</td>
</tr>

<tr>
<td>trx_unique_checks</td>
<td>是否打开唯一性检查的标识。</td>
</tr>

<tr>
<td>trx_foreign_key_checks</td>
<td>是否打开外键检查的标识。</td>
</tr>

<tr>
<td>trx_last_foreign_key_error</td>
<td>最后一次的外键错误信息。</td>
</tr>

<tr>
<td>trx_adaptive_hash_latched</td>
<td>自适应散列索引是否被当前事务锁住的标识。</td>
</tr>

<tr>
<td>trx_adaptive_hash_timeout</td>
<td>是否立刻放弃为自适应散列索引搜索 LATCH 的标识。</td>
</tr>
</tbody>
</table>

<h3 id="innodb-locks">innodb_locks</h3>

<table>
<thead>
<tr>
<th>字段</th>
<th>注释</th>
</tr>
</thead>

<tbody>
<tr>
<td>lock_id</td>
<td>锁 ID。</td>
</tr>

<tr>
<td><strong>lock_trx_id</strong></td>
<td>拥有锁的事务 ID。可以和 INNODB_TRX 表 JOIN 得到事务的详细信息。</td>
</tr>

<tr>
<td>lock_mode</td>
<td>锁的模式。有如下锁类型: 行级锁包括 S、X、IS、IX，分别代表共享锁、排它锁、意向共享锁、意向排它锁。表级锁包括 S_GAP、X_GAP、IS_GAP、IX_GAP 和 AUTO_INC，分别代表共享间隙锁、排它间隙锁、意向共享间隙锁、意向排它间隙锁和自动递增锁。</td>
</tr>

<tr>
<td><strong>lock_type</strong></td>
<td>锁的类型。RECORD 代表行级锁，TABLE 代表表级锁。</td>
</tr>

<tr>
<td>lock_table</td>
<td>被锁定的或者包含锁定记录的表的名称。</td>
</tr>

<tr>
<td>lock_index</td>
<td>当 LOCK_TYPE=’RECORD’ 时，表示索引的名称；否则为 NULL。</td>
</tr>

<tr>
<td>lock_space</td>
<td>当 LOCK_TYPE=’RECORD’ 时，表示锁定行的表空间 ID；否则为 NULL。</td>
</tr>

<tr>
<td>lock_page</td>
<td>当 LOCK_TYPE=’RECORD’ 时，表示锁定行的页号；否则为 NULL。</td>
</tr>

<tr>
<td>lock_rec</td>
<td>当 LOCK_TYPE=’RECORD’ 时，表示一堆页面中锁定行的数量，亦即被锁定的记录号；否则为 NULL。</td>
</tr>

<tr>
<td>lock_data</td>
<td>当 LOCK_TYPE=’RECORD’ 时，表示锁定行的主键；否则为NULL。</td>
</tr>
</tbody>
</table>

<h3 id="innodb-lock-waits">innodb_lock_waits</h3>

<p>| 字段                         | 注释                                                                             |
| &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;  &mdash;&mdash; |
| requesting_trx_id            | 请求事务的 ID。                                                                  |
| requested_lock_id            | 事务所等待的锁定的 ID。可以和 INNODB_LOCKS 表 JOIN。                             |
| blocking_trx_id              | 阻塞事务的 ID。                                                                  |
| blocking_lock_id             | 某一事务的锁的 ID，该事务阻塞了另一事务的运行。可以和 INNODB_LOCKS 表 JOIN。     |</p>

<h2 id="常用">常用</h2>

<h3 id="默认查询">默认查询</h3>

<ul>
<li><code>SELECT * FROM information_schema.innodb_trx \G</code></li>
<li><code>SELECT * FROM information_schema.innodb_locks \G</code></li>
<li><code>SELECT * FROM information_schema.innodb_lock_waits \G</code></li>
</ul>

<h3 id="锁等待时长">锁等待时长</h3>

<ul>
<li><code>SHOW VARIABLES LIKE '%innodb_lock_wait%'</code></li>
<li><code>SET innodb_lock_wait_timeout=600;</code></li>
</ul>

<h3 id="事务处理">事务处理</h3>

<ul>
<li>显示锁事件

<ul>
<li><code>SELECT trx_id, trx_requested_lock_id, trx_mysql_thread_id, trx_query FROM information_schema.innodb_trx WHERE trx_state = 'LOCK WAIT' \G</code></li>
</ul></li>
<li>消除锁

<ul>
<li><code>kill {trx_mysql_thread_id}</code></li>
</ul></li>
</ul>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fmysql.lock-waits%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=MYSQL.LOCK-WAITS&amp;url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fmysql.lock-waits%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fmysql.lock-waits%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fmysql.lock-waits%2f&title=MYSQL.LOCK-WAITS" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yqjdcyy-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
    </main>
    <aside class="author">
  <img class="profile-image" src="http://domain.yqjdcyy.com/img/profile-image.png" alt="姚清居" />
  <p class="name"> 
  <strong>姚清居</strong></p>
  <p class="address">Earth</p>
  <p class="link"></p>
  <ul class="social">
    












<li><a href="//github.com/yqjdcyy" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://domain.yqjdcyy.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://domain.yqjdcyy.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2018 &middot; Powered by <a href="http://www.domain.yqjdcyy.com">姚清居</a>.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/domain.yqjdcyy.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://domain.yqjdcyy.com/js/plugins.js"></script>




</body>
</html>

