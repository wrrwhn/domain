<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>READ FROM LIFE</title>
        <meta name="author">
        <meta name="description" content="姚清居到此一游">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.30.2" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="alternate" type="application/rss+xml" title="READ FROM LIFE" />
        <link href="http://domain.yqjdcyy.com/post/index.xml" rel="feed" type="application/rss+xml" title="READ FROM LIFE" />
        <link href='//fonts.googleapis.com/css?family=Roboto:400,300,700|Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/styles.css">
        <link rel="icon" href="http://domain.yqjdcyy.com/favicon.ico">
        <link rel="apple-touch-icon" href="http://domain.yqjdcyy.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="http://domain.yqjdcyy.com/css/highlightjs/monokai.css">
        <script src="http://domain.yqjdcyy.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(http://domain.yqjdcyy.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(http://domain.yqjdcyy.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
        
        <header class="site-header">
          <div class="transparent-layer">
              <h2></h2>
          </div>
        </header>


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">
            <a class="btn home" href="http://domain.yqjdcyy.com/" title="">&laquo; </a>
            
<h1><a href="http://domain.yqjdcyy.com/post/spring.basic/" title="Spring.Basic">Spring.Basic</a></h1>

<footer class="post-info"> <span class="post-meta"><time datetime="2016.12.11">2016.12.11</time>

    &middot; 
        
        <a href="http://domain.yqjdcyy.com/tags/%E6%95%B4%E7%90%86">整理</a>, 
        
        <a href="http://domain.yqjdcyy.com/tags/spring">spring</a>
        
    

</span>
</footer>

            

<p>[TOC]</p>

<h2 id="aop-http-my-oschina-net-huangyong-blog-161338"><a href="http://my.oschina.net/huangyong/blog/161338">AOP</a></h2>

<h3 id="介绍">介绍</h3>

<ul>
<li>Aspect-Oriented Programming</li>
<li>面向切面编程，对着代码横着切入</li>
<li>对方法的增强为 Weaving （织入）</li>
<li>对类的增强为 Introduction （引入）</li>
</ul>

<h3 id="代理">代理</h3>

<h4 id="代码写死">代码写死</h4>

<ul>
<li><p>interface</p>

<pre><code class="language-java">public interface Greeting {  
 
void sayHello(String name);  
} 
</code></pre></li>

<li><p>implement</p>

<pre><code class="language-java">public class GreetingImpl implements Greeting {  
 
@Override 
public void sayHello(String name) {  
    before();  
    System.out.println(&quot;Hello! &quot; + name);  
    after();  
}  
 
private void before() {  
    System.out.println(&quot;Before&quot;);  
}  
 
private void after() {  
    System.out.println(&quot;After&quot;);  
}  
} 
</code></pre></li>
</ul>

<h4 id="静态代理">静态代理</h4>

<ul>
<li>resolution</li>
<li>单独为 GeetingImpl 创建代理类</li>

<li><p>proxy</p>

<pre><code class="language-java">public class GreetingProxy implements Greeting {  
 
private GreetingImpl greetingImpl;  
 
public GreetingProxy(GreetingImpl greetingImpl) {  
    this.greetingImpl = greetingImpl;  
}  
 
@Override 
public void sayHello(String name) {  
    before();  
    greetingImpl.sayHello(name);  
    after();  
}  
 
private void before() {  
    System.out.println(&quot;Before&quot;);  
}  
 
private void after() {  
    System.out.println(&quot;After&quot;);  
}  
} 
</code></pre></li>

<li><p>call</p>

<pre><code class="language-java">Greeting greetingProxy = new GreetingProxy(new GreetingImpl());  
greetingProxy.sayHello(&quot;Jack&quot;);  
</code></pre></li>
</ul>

<h4 id="jdk-动态代理">JDK 动态代理</h4>

<ul>
<li>resolution</li>
<li>合并所有代理类功能至动态代理类中</li>
<li>只能代理接口</li>

<li><p>proxy</p>

<pre><code class="language-java">public class JDKDynamicProxy implements InvocationHandler {  
 
private Object target;  
 
public JDKDynamicProxy(Object target) {  
    this.target = target;  
}  
 
@SuppressWarnings(&quot;unchecked&quot;)  
public &lt;T&gt; T getProxy() {  
    return (T) Proxy.newProxyInstance(  
        target.getClass().getClassLoader(),   // 使用该实现类的接口实现
        target.getClass().getInterfaces(),   // 通用代理功能
        this  // 代理实现功能
    );  
}  
 
@Override 
public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {  
    before();  
    Object result = method.invoke(target, args);  
    after();  
    return result;  
}  
 
private void before() {  
    System.out.println(&quot;Before&quot;);  
}  
 
private void after() {  
    System.out.println(&quot;After&quot;);  
}  
} 
</code></pre></li>

<li><p>call</p>

<pre><code class="language-java">Greeting greeting = new JDKDynamicProxy(new GreetingImpl()).getProxy();  
greeting.sayHello(&quot;Jack&quot;);  
</code></pre></li>
</ul>

<h4 id="cglib-动态代理">CGLib 动态代理</h4>

<ul>
<li>resolution</li>
<li>支持对任意类的代理</li>

<li><p>proxy</p>

<pre><code class="language-java">public class CGLibDynamicProxy implements MethodInterceptor {  
 
private static CGLibDynamicProxy instance = new CGLibDynamicProxy();  
 
private CGLibDynamicProxy() {  
}  
 
public static CGLibDynamicProxy getInstance() {  
    return instance;  
}  
 
@SuppressWarnings(&quot;unchecked&quot;)  
public &lt;T&gt; T getProxy(Class&lt;T&gt; cls) {  
    return (T) Enhancer.create(cls, this);  
}  
 
@Override 
public Object intercept(Object target, Method method, Object[] args, MethodProxy proxy) throws Throwable {  
    before();  
    Object result = proxy.invokeSuper(target, args);  // 使用反射支持所有类
    after();  
    return result;  
}  
 
private void before() {  
    System.out.println(&quot;Before&quot;);  
}  
 
private void after() {  
    System.out.println(&quot;After&quot;);  
}  
} 
</code></pre></li>

<li><p>call</p>

<pre><code class="language-java">Greeting greeting = CGLibDynamicProxy.getInstance().getProxy(GreetingImpl.class);  
greeting.sayHello(&quot;Jack&quot;);  
</code></pre></li>
</ul>

<h3 id="spring-aop">Spring AOP</h3>

<h4 id="前置增强">前置增强</h4>

<ul>
<li><p>proxy</p>

<pre><code class="language-java">@Component
public class GreetingBeforeAdvice implements MethodBeforeAdvice {  

@Override 
public void before(Method method, Object[] args, Object target) throws Throwable {  
    System.out.println(&quot;Before&quot;);  
}  
} 
</code></pre></li>

<li><p>call
``` java
ProxyFactory proxyFactory = new ProxyFactory();     // 创建代理工厂<br />
proxyFactory.setTarget(new GreetingImpl());         // 射入目标类对象<br />
proxyFactory.addAdvice(new GreetingBeforeAdvice()); // 添加前置增强</p></li>
</ul>

<p>Greeting greeting = (Greeting) proxyFactory.getProxy(); // 从代理工厂中获取代理<br />
greeting.sayHello(&ldquo;Jack&rdquo;);</p>

<pre><code>

#### 后置增强
- proxy
``` java
@Component
public class GreetingAfterAdvice implements AfterReturningAdvice {  
 
    @Override 
    public void afterReturning(Object result, Method method, Object[] args, Object target) throws Throwable {  
        System.out.println(&quot;After&quot;);  
    }  
} 
</code></pre>

<ul>
<li>call
``` java
ProxyFactory proxyFactory = new ProxyFactory();     // 创建代理工厂<br />
proxyFactory.setTarget(new GreetingImpl());         // 射入目标类对象<br />
proxyFactory.addAdvice(new GreetingAfterAdvice());  // 添加后置增强<br /></li>
</ul>

<p>Greeting greeting = (Greeting) proxyFactory.getProxy(); // 从代理工厂中获取代理<br />
greeting.sayHello(&ldquo;Jack&rdquo;);</p>

<pre><code>
#### 环绕增强
- resolution
- 前置增强+ 后置增强
- proxy
``` java
@Component
public class GreetingAroundAdvice implements MethodInterceptor {  
 
    @Override 
    public Object invoke(MethodInvocation invocation) throws Throwable {  
        before();  
        Object result = invocation.proceed();  
        after();  
        return result;  
    }  
 
    private void before() {  
        System.out.println(&quot;Before&quot;);  
    }  
 
    private void after() {  
        System.out.println(&quot;After&quot;);  
    }  
} 
</code></pre>

<ul>
<li>call
<code>java
ApplicationContext context = new ClassPathXmlApplicationContext(&quot;aop/demo/spring.xml&quot;);  // 获取 Spring Context  
Greeting greeting = (Greeting) context.getBean(&quot;greetingProxy&quot;);  // 从 Context 中根据 id 获取 Bean 对象（其实就是一个代理）  
greeting.sayHello(&quot;Jack&quot;); 
</code></li>
</ul>

<h4 id="抛出增强">抛出增强</h4>

<ul>
<li><p>implements</p>

<pre><code class="language-java">@Component 
public class GreetingImpl implements Greeting {  
 
@Override 
public void sayHello(String name) {  
    System.out.println(&quot;Hello! &quot; + name);  
 
    throw new RuntimeException(&quot;Error&quot;); // 故意抛出一个异常，看看异常信息能否被拦截到  
}  
}
</code></pre></li>

<li><p>proxy</p>

<pre><code class="language-java">@Component 
public class GreetingThrowAdvice implements ThrowsAdvice {  
 
public void afterThrowing(Method method, Object[] args, Object target, Exception e) {  
    System.out.println(&quot;---------- Throw Exception ----------&quot;);  
    System.out.println(&quot;Target Class: &quot; + target.getClass().getName());  
    System.out.println(&quot;Method Name: &quot; + method.getName());  
    System.out.println(&quot;Exception Message: &quot; + e.getMessage());  
    System.out.println(&quot;-------------------------------------&quot;);  
}  
} 
</code></pre></li>
</ul>

<h4 id="引入增强">引入增强</h4>

<ul>
<li><p>interface</p>

<pre><code class="language-java">public interface Apology {  
 
void saySorry(String name);  
} 
</code></pre></li>

<li><p>proxy</p>

<pre><code class="language-java">@Component 
public class GreetingIntroAdvice extends DelegatingIntroductionInterceptor implements Apology {  
 
@Override 
public Object invoke(MethodInvocation invocation) throws Throwable {  
    return super.invoke(invocation);  
}  
 
@Override 
public void saySorry(String name) {  
    System.out.println(&quot;Sorry! &quot; + name);  
}  
} 
</code></pre></li>

<li><p>config</p>

<pre><code class="language-xml">&lt;bean id=&quot;greetingProxy&quot; class=&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;&gt; 
&lt;property name=&quot;interfaces&quot; value=&quot;aop.demo.Apology&quot;/&gt;          &lt;!-- 需要动态实现的接口 --&gt; 
&lt;property name=&quot;target&quot; ref=&quot;greetingImpl&quot;/&gt;                    &lt;!-- 目标类 --&gt; 
&lt;property name=&quot;interceptorNames&quot; value=&quot;greetingIntroAdvice&quot;/&gt; &lt;!-- 引入增强 --&gt; 
&lt;property name=&quot;proxyTargetClass&quot; value=&quot;true&quot;/&gt;                &lt;!-- 使用CGLib代理目标类（默认为 false，使用JDK动态代理接口） --&gt; 
&lt;/bean&gt; 
</code></pre></li>

<li><p>call
``` java
ApplicationContext context = new ClassPathXmlApplicationContext(&ldquo;aop/demo/spring.xml&rdquo;);<br />
GreetingImpl greetingImpl = (GreetingImpl) context.getBean(&ldquo;greetingProxy&rdquo;); // 注意：转型为目标类，而并非它的 Greeting 接口<br />
greetingImpl.sayHello(&ldquo;Jack&rdquo;);</p></li>
</ul>

<p>Apology apology = (Apology) greetingImpl; // 将目标类强制向上转型为 Apology 接口（这是引入增强给我们带来的特性，也就是“接口动态实现”功能）<br />
apology.saySorry(&ldquo;Jack&rdquo;);<br />
```</p>

            <ul class="share-buttons">
    <li></li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fspring.basic%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=Spring.Basic&amp;url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fspring.basic%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fspring.basic%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title=""></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fdomain.yqjdcyy.com%2fpost%2fspring.basic%2f&title=Spring.Basic" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title=""></a>
    </li>
</ul>

        </article>
        
        <div class="comments">
            <h3></h3>
            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yqjdcyy-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
        
    </main>
    <aside class="author">
  <img class="profile-image" src="http://domain.yqjdcyy.com/img/profile-image.png" alt="姚清居" />
  <p class="name"> 
  <strong>姚清居</strong></p>
  <p class="address">Earth</p>
  <p class="link"></p>
  <ul class="social">
    












<li><a href="//github.com/wrrwhn" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="http://domain.yqjdcyy.com/post/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

  </ul>
  <br><br>
</aside>

</div>

<footer class="main-footer">
  <div class="container clearfix">
        <a class="icon-rss" href="http://domain.yqjdcyy.com/post/index.xml" title="RSS"></a>
        <p>&copy; 2018 &middot; Powered by <a href="http://www.yqjdcyy.com">姚清居</a>.</p>
  </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="http:\/\/domain.yqjdcyy.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="http://domain.yqjdcyy.com/js/plugins.js"></script>




</body>
</html>

