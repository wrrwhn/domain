<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Java.JVM.Monitor - 好久不见</title>
    <meta name="keywords" content="好久不见,博客,程序,思考,笔记,分享">
    
    <meta property="og:title" content="Java.JVM.Monitor">
    <meta property="og:site_name" content="好久不见">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Java.JVM.Monitor - 好久不见" />
    <meta name="description" content="好久不见 | 博客 | 程序 | 思考 | 笔记 | 分享"> 
    
    <link rel="shortcut icon" href="http://domain.yqjdcyy.com/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://domain.yqjdcyy.com/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://domain.yqjdcyy.com/img/apple-touch-icon.png" />
    <link href="http://domain.yqjdcyy.com/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://domain.yqjdcyy.com/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">好久不见</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">生之所向</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E6%95%B4%E7%90%86/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-code"></i> <br />整理
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E9%98%85%E8%AF%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tint"></i> <br />阅读
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E4%B9%90%E8%B6%A3/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tint"></i> <br />乐趣
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/about/%E5%85%B3%E4%BA%8E/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://domain.yqjdcyy.com/post/java.monitor/" itemprop="url">
        Java.JVM.Monitor
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2018-12-30">
    2018-12-30
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://domain.yqjdcyy.com/categories/%E6%95%B4%E7%90%86" itemprop="url" rel="index">
        <span itemprop="name">整理</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">1096 字 ~3分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    

<h1 id="文档">文档</h1>

<h2 id="monitor">monitor</h2>

<ul>
<li><p>描述</p>

<ul>
<li><p>原文</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Synchronizationis built around an internal entity known as the intrinsic lock or monitor lock<span style="color:#f92672">.</span> <span style="color:#f92672">(</span>The API specification often refers to <span style="color:#66d9ef">this</span> entity simplyas a <span style="color:#960050;background-color:#1e0010">“</span>monitor<span style="color:#f92672">.</span><span style="color:#960050;background-color:#1e0010">”</span><span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">，</span>
Every object has an intrinsic lock associated with it<span style="color:#f92672">.</span>
By convention<span style="color:#f92672">,</span> a thread that needs exclusive and consistent access to an object<span style="color:#960050;background-color:#1e0010">’</span>s fields has to acquire the object<span style="color:#960050;background-color:#1e0010">’</span>s intrinsic lock before accessing them<span style="color:#f92672">,</span> 
and then release the intrinsic lock when it<span style="color:#960050;background-color:#1e0010">’</span>s done with them<span style="color:#f92672">.</span></code></pre></div></li>

<li><p>理解</p>

<ul>
<li>每个对象都拥有一内部事务锁</li>
<li>当进程要访问字段前，需先排他性地获得该内部锁，并于操作完成后释放该锁</li>
</ul></li>
</ul></li>
</ul>

<h2 id="monitorenter">monitorenter</h2>

<ul>
<li><p>原文</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="color:#a6e22e">Each</span> <span style="color:#a6e22e">object</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">associated</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">monitor</span>. <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">locked</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">only</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">it</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">an</span> <span style="color:#a6e22e">owner</span>. <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">executes</span> <span style="color:#a6e22e">monitorenter</span> <span style="color:#a6e22e">attempts</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">gain</span> <span style="color:#a6e22e">ownership</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">associated</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">objectref</span>, <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">follows</span>:
    <span style="color:#a6e22e">If</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">count</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">associated</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">objectref</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">zero</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">enters</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">sets</span> <span style="color:#a6e22e">its</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">count</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">one</span>. <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">then</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">owner</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span>.
    <span style="color:#a6e22e">If</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">already</span> <span style="color:#a6e22e">owns</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">associated</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">objectref</span>, <span style="color:#a6e22e">it</span> <span style="color:#a6e22e">reenters</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span>, <span style="color:#a6e22e">incrementing</span> <span style="color:#a6e22e">its</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">count</span>.
    <span style="color:#a6e22e">If</span> <span style="color:#a6e22e">another</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">already</span> <span style="color:#a6e22e">owns</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">associated</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">objectref</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">blocks</span> <span style="color:#a6e22e">until</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">s</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">count</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">zero</span>, <span style="color:#a6e22e">then</span> <span style="color:#a6e22e">tries</span> <span style="color:#a6e22e">again</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">gain</span> <span style="color:#a6e22e">ownership</span>.

<span style="color:#a6e22e">A</span> <span style="color:#a6e22e">monitorenter</span> <span style="color:#a6e22e">instruction</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">used</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">one</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">more</span> <span style="color:#a6e22e">monitorexit</span> <span style="color:#a6e22e">instructions</span> (<span style="color:#960050;background-color:#1e0010">§</span><span style="color:#a6e22e">monitorexit</span>) <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">implement</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">synchronized</span> <span style="color:#a6e22e">statement</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Java</span> <span style="color:#a6e22e">programming</span> <span style="color:#a6e22e">language</span> (<span style="color:#960050;background-color:#1e0010">§</span><span style="color:#ae81ff">3.14</span>). <span style="color:#a6e22e">The</span> <span style="color:#a6e22e">monitorenter</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">monitorexit</span> <span style="color:#a6e22e">instructions</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">used</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">implementation</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">synchronized</span> <span style="color:#a6e22e">methods</span>, <span style="color:#a6e22e">although</span> <span style="color:#a6e22e">they</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">used</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">provide</span> <span style="color:#a6e22e">equivalent</span> <span style="color:#a6e22e">locking</span> <span style="color:#a6e22e">semantics</span>. <span style="color:#a6e22e">Monitor</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">invocation</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">synchronized</span> <span style="color:#a6e22e">method</span>, <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">exit</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">its</span> <span style="color:#66d9ef">return</span>, <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">handled</span> <span style="color:#a6e22e">implicitly</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Java</span> <span style="color:#a6e22e">Virtual</span> <span style="color:#a6e22e">Machine</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#a6e22e">s</span> <span style="color:#a6e22e">method</span> <span style="color:#a6e22e">invocation</span> <span style="color:#a6e22e">and</span> <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">instructions</span>, <span style="color:#a6e22e">as</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">monitorenter</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">monitorexit</span> <span style="color:#a6e22e">were</span> <span style="color:#a6e22e">used</span>.

<span style="color:#a6e22e">The</span> <span style="color:#a6e22e">association</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">an</span> <span style="color:#a6e22e">object</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">managed</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">various</span> <span style="color:#a6e22e">ways</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">beyond</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">scope</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">this</span> <span style="color:#a6e22e">specification</span>. <span style="color:#a6e22e">For</span> <span style="color:#a6e22e">instance</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">allocated</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">deallocated</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">same</span> <span style="color:#a6e22e">time</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">object</span>. <span style="color:#a6e22e">Alternatively</span>, <span style="color:#a6e22e">it</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">dynamically</span> <span style="color:#a6e22e">allocated</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">time</span> <span style="color:#a6e22e">when</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">attempts</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">gain</span> <span style="color:#a6e22e">exclusive</span> <span style="color:#a6e22e">access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">object</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">freed</span> <span style="color:#a6e22e">at</span> <span style="color:#a6e22e">some</span> <span style="color:#a6e22e">later</span> <span style="color:#a6e22e">time</span> <span style="color:#a6e22e">when</span> <span style="color:#a6e22e">no</span> <span style="color:#a6e22e">thread</span> <span style="color:#a6e22e">remains</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">monitor</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">object</span>.

<span style="color:#a6e22e">The</span> <span style="color:#a6e22e">synchronization</span> <span style="color:#a6e22e">constructs</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Java</span> <span style="color:#a6e22e">programming</span> <span style="color:#a6e22e">language</span> <span style="color:#a6e22e">require</span> <span style="color:#a6e22e">support</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">operations</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">monitors</span> <span style="color:#a6e22e">besides</span> <span style="color:#a6e22e">entry</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">exit</span>. <span style="color:#a6e22e">These</span> <span style="color:#a6e22e">include</span> <span style="color:#a6e22e">waiting</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">monitor</span> (<span style="color:#a6e22e">Object</span>.<span style="color:#a6e22e">wait</span>) <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">notifying</span> <span style="color:#a6e22e">other</span> <span style="color:#a6e22e">threads</span> <span style="color:#a6e22e">waiting</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">monitor</span> (<span style="color:#a6e22e">Object</span>.<span style="color:#a6e22e">notifyAll</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">Object</span>.<span style="color:#a6e22e">notify</span>). <span style="color:#a6e22e">These</span> <span style="color:#a6e22e">operations</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">supported</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">standard</span> <span style="color:#f92672">package</span> <span style="color:#a6e22e">java</span>.<span style="color:#a6e22e">lang</span> <span style="color:#a6e22e">supplied</span> <span style="color:#a6e22e">with</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Java</span> <span style="color:#a6e22e">Virtual</span> <span style="color:#a6e22e">Machine</span>. <span style="color:#a6e22e">No</span> <span style="color:#a6e22e">explicit</span> <span style="color:#a6e22e">support</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">these</span> <span style="color:#a6e22e">operations</span> <span style="color:#a6e22e">appears</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">instruction</span> <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">Java</span> <span style="color:#a6e22e">Virtual</span> <span style="color:#a6e22e">Machine</span>.</pre></div></li>

<li><p>理解</p>

<ul>
<li>每个对象都关联一个 <code>monitor</code>，当其拥有所有者时， <code>monitor</code> 将被锁定

<ul>
<li>当对象引用的 <code>monitor</code> 的持有者为空（进入的数量为0）时，线程才能拥有该 <code>monitor</code> 并将其进入数更新为 <code>1</code></li>
<li>当拥有 <code>monitor</code> 的持有者重复进入，则将进入数自增</li>
<li>当 <code>monitor</code> 有拥有者时，其它进程必须阻塞以等待拥有者退出，进入数重置为 <code>0</code></li>
</ul></li>
<li>对象与 <code>monitor</code> 同时分配、释放</li>
<li><code>java.lang.Object</code> 对象通过 <code>wait</code> 和 <code>notifyAll</code> 隐性支持了 monitor 的 进入和退出</li>
</ul></li>
</ul>

<h2 id="monitorexit">monitorexit</h2>

<ul>
<li><p>原文</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">The objectref must be of type reference.

The thread that executes monitorexit must be the owner of the monitor associated with the instance referenced by objectref.

The thread decrements the entry count of the monitor associated with objectref. If as a result the value of the entry count is zero, the thread exits the monitor and is no longer its owner. Other threads that are blocking to enter the monitor are allowed to attempt to do so.
One or more monitorexit instructions may be used with a monitorenter instruction (§monitorenter) to implement a synchronized statement in the Java programming language (§3.14). The monitorenter and monitorexit instructions are not used in the implementation of synchronized methods, although they can be used to provide equivalent locking semantics.

The Java Virtual Machine supports exceptions thrown within synchronized methods and synchronized statements differently:

Monitor exit on normal synchronized method completion is handled by the Java Virtual Machine&#39;s return instructions. Monitor exit on abrupt synchronized method completion is handled implicitly by the Java Virtual Machine&#39;s athrow instruction.

When an exception is thrown from within a synchronized statement, exit from the monitor entered prior to the execution of the synchronized statement is achieved using the Java Virtual Machine&#39;s exception handling mechanism (§3.14).</pre></div></li>

<li><p>理解</p>

<ul>
<li>调用 <code>monitorexit</code> 的线程仅可为拥有其 <code>monitor</code> 的对象引用所关联的实例</li>
<li>线程调用 <code>monitorexit</code> 时，将减少其关联的 <code>monitor</code> 的进入数，并当进入数减少为 0 时，失去对该对象的所有权</li>
<li>异常处理机制

<ul>
<li>同步方法将由 JVM 的 <code>athrow</code> 指令隐性处理</li>
<li>同步块则由 JVM 的异常处理机制接收</li>
</ul></li>
</ul></li>
</ul>

<h1 id="实现">实现</h1>

<h2 id="objectmonitor">ObjectMonitor</h2>

<h3 id="结构">结构</h3>

<ul>
<li>HotSpot.ObjectMonitor</li>
</ul>

<table>
<thead>
<tr>
<th>字段</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>_owner</td>
<td>持有线程</td>
</tr>

<tr>
<td>_recursions</td>
<td>持有线程的进入次数</td>
</tr>

<tr>
<td>_cxq</td>
<td>多线程竞争锁时使用<br>单向链表</td>
</tr>

<tr>
<td>_EntryList</td>
<td>待竞选线程池<br>双向循环链表</td>
</tr>

<tr>
<td>_WaitSet</td>
<td>等待线程池<br>双向循环链表</td>
</tr>
</tbody>
</table>

<h3 id="流程">流程</h3>

<ul>
<li><img src="http://doc.yqjdcyy.com/eddc8cc2-61d7-4b60-bd8e-d2de51e424e4.png" alt="Java.Object.Monitor.png" /></li>
</ul>

<h1 id="参考">参考</h1>

<ul>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.monitorenter">monitorenter</a></li>
<li><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.monitorexit">monitorexit</a></li>
<li><a href="http://hg.openjdk.java.net/jdk8/jdk8/hotspot/file/87ee5ee27509/src/share/vm/oops/markOop.hpp">markOop.hpp</a>

<ul>
<li>object-monitor 源码</li>
</ul></li>
<li><a href="https://www.cnblogs.com/kundeg/p/8422557.html">从jvm源码看synchronized</a></li>
</ul>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://domain.yqjdcyy.com/tags/java" rel="tag" title="Java">#Java#</a>
    
    <a href="http://domain.yqjdcyy.com/tags/jvm" rel="tag" title="JVM">#JVM#</a>
    
    <a href="http://domain.yqjdcyy.com/tags/thread" rel="tag" title="Thread">#Thread#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://domain.yqjdcyy.com/post/java.security/" rel="next" title="Java.Security">
        <i class="fa fa-chevron-left"></i> Java.Security
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://domain.yqjdcyy.com/post/java.keyword.volatile/" rel="prev" title="Java.Keyword.Volatile">
        Java.Keyword.Volatile <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     <div class="post-nav">
    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
        <div>
            <p style="margin-top:0px;">
                标题：Java.JVM.Monitor
                <br />作者：
                <a target="_blank" href="http://domain.yqjdcyy.com/">好久不见</a>
                <br />关注：好久不见
                <br />声明：自由转载-非商用-非衍生-保持署名（创作共享3.0许可证）
            </p>
        </div>
    </div>
    <div class="clear"></div>
</div>
     
     
     




    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

  <ul class="sidebar-nav motion-element">
    <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
      文章目录
    </li>
    <li class="sidebar-nav-overview" data-target="site-overview">
      站点概览
    </li>
  </ul>

    <section class="site-overview sidebar-panel ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://domain.yqjdcyy.com/img/profile-image.png"
        alt="好久不见" />
    <p class="site-author-name" itemprop="name">好久不见</p>
    <p class="site-description motion-element" itemprop="description"> 
        Have fun~</p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://domain.yqjdcyy.com/post/">
        <span class="site-state-item-count">282</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://domain.yqjdcyy.com/categories/">      
         
        <span class="site-state-item-count">9</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://domain.yqjdcyy.com/tags/">
         
        <span class="site-state-item-count">128</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/yqjdcyy" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>

      
      <div class="links-of-blogroll motion-element inline">
    <script type="text/javascript" src="//ra.revolvermaps.com/0/0/8.js?i=04ljtqzk00r&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=1"
        async="async"></script>
</div>
    </section>
    
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
    <div class="post-toc">
        <div class="post-toc-content"><nav id="TableOfContents">
<ul>
<li><a href="#文档">文档</a>
<ul>
<li><a href="#monitor">monitor</a></li>
<li><a href="#monitorenter">monitorenter</a></li>
<li><a href="#monitorexit">monitorexit</a></li>
</ul></li>
<li><a href="#实现">实现</a>
<ul>
<li><a href="#objectmonitor">ObjectMonitor</a>
<ul>
<li><a href="#结构">结构</a></li>
<li><a href="#流程">流程</a></li>
</ul></li>
</ul></li>
<li><a href="#参考">参考</a></li>
</ul>
</nav></div>
    </div>
</section>

  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2019</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">好久不见</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.30.2</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://domain.yqjdcyy.com/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://domain.yqjdcyy.com/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/utils.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/motion.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/affix.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/scrollspy.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/post-details.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/toc.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/bootstrap.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/search.js"></script>
</body>
</html>