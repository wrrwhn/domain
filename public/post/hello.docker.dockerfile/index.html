<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>Hello.Docker.Dockerfile - 好久不见</title>
    <meta name="keywords" content="好久不见,博客,程序,思考,笔记,分享">
    
    <meta property="og:title" content="Hello.Docker.Dockerfile">
    <meta property="og:site_name" content="好久不见">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="Hello.Docker.Dockerfile - 好久不见" />
    <meta name="description" content="好久不见 | 博客 | 程序 | 思考 | 笔记 | 分享"> 
    
    <link rel="shortcut icon" href="http://domain.yqjdcyy.com/img/favicon.ico" />
    <link rel="apple-touch-icon" href="http://domain.yqjdcyy.com/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="http://domain.yqjdcyy.com/img/apple-touch-icon.png" />
    <link href="http://domain.yqjdcyy.com/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/css/main.css" rel="stylesheet" type="text/css" />
    <link href="http://domain.yqjdcyy.com/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="http://domain.yqjdcyy.com/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">好久不见</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">生之所向</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E6%95%B4%E7%90%86/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-code"></i> <br />整理
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E9%98%85%E8%AF%BB/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tint"></i> <br />阅读
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/categories/%E4%B9%90%E8%B6%A3/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tint"></i> <br />乐趣
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="http://domain.yqjdcyy.com/about/%E5%85%B3%E4%BA%8E/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="http://domain.yqjdcyy.com/post/hello.docker.dockerfile/" itemprop="url">
        Hello.Docker.Dockerfile
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2018-06-20">
    2018-06-20
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="http://domain.yqjdcyy.com/categories/%E6%95%B4%E7%90%86" itemprop="url" rel="index">
        <span itemprop="name">整理</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2193 字 ~5分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    

<h1 id="work">Work</h1>

<ul>
<li><code>Docker</code> 镜像是由只读的层一层层封装而成的，而其中的层均代码着 <code>Dockerfile</code> 指令</li>
</ul>

<h1 id="guidlines">Guidlines</h1>

<ul>
<li>保持支持容器可补停止、摧毁，然后重新构建并替换的最小化配置</li>
<li>不管实际执行的 <code>Dockerfile</code> 在哪，当前目录下的文件和目录都将发送至 <code>Docker</code> 守护进程中作为构建上下文中

<ul>
<li>执行 <code>docker build</code> 的当前所在目录，称为构建上下文</li>
<li>默认 <code>Dockerfile</code> 文件存放于构建上下文中，但也可通过 <code>-f</code> 指令指定</li>
</ul></li>
</ul>

<h1 id="command">Command</h1>

<h2 id="parser-directives">Parser directives</h2>

<ul>
<li>作用

<ul>
<li>用于指定 <code>Dockerfile</code> 中的转义字符或换行

<ul>
<li>默认为 <code>\</code></li>
<li>重新定义转义字符为 <code>`</code>，主要用于支持 Windows PowerShell脚本，为 <code>c:\\</code> 情况</li>
<li>编译时不添加至 <code>Docker</code> 层，也不显示作为编译的其中一个步骤</li>
<li>位置应该置于文件顶部，不然当处理完注释、空行或构建指令后, <code>Docker</code> 将不再寻找解析器指令</li>
</ul></li>
</ul></li>
<li>指令

<ul>
<li><code># directive=value</code>

<ul>
<li>仅可使用一次</li>
<li>非大小写敏感，允许空格等非断行型空白</li>
<li>无效情况

<ul>
<li><code>\</code>(续行符)</li>
<li>重复多次</li>
</ul></li>
</ul></li>
</ul></li>
<li>使用

<ul>
<li><code># escape=[\|`]</code></li>
</ul></li>
</ul>

<h2 id="env">ENV</h2>

<ul>
<li>作用

<ul>
<li>变量定义</li>
</ul></li>
<li>定义

<ul>
<li><code>ENV variable.name variable.value</code></li>
</ul></li>
<li>使用

<ul>
<li><code>${variable}= $variable</code></li>
<li><code>${variable:-default}</code>

<ul>
<li>= nul!= <code>$variable</code> ? <code>$variable</code> : <code>default</code></li>
</ul></li>
<li><code>${variable:+default}</code>

<ul>
<li>= nul!= <code>$variable</code> ? <code>default</code> : <code>&quot;&quot;</code></li>
</ul></li>
</ul></li>
</ul>

<h2 id="from">FROM</h2>

<ul>
<li>作用

<ul>
<li>指定的构建基础，来源可由任意公共存储库的有效镜像

<ul>
<li><code>Dockerfile</code> 必须以 <code>FROM</code> 开始</li>
</ul></li>
</ul></li>
<li>指令

<ul>
<li><code>FROM &lt;image&gt;[:&lt;tag&gt;|@&lt;digest&gt;] [AS &lt;name&gt;]</code>

<ul>
<li><code>AS &lt;name&gt;</code>

<ul>
<li>可选项，设置当前引用在新构建阶段的名称

<ul>
<li>可于后续的 <code>FROM</code> 和 <code>COPY</code></li>
<li>FROM=<name|index></li>
</ul></li>
</ul></li>
<li><code>:&lt;tag&gt;|@&lt;digest&gt;</code>

<ul>
<li>可选项，用于指定对应的版本

<ul>
<li>默认为 <code>lastest</code></li>
<li>当构建器找不到指定版本时，返回异常</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>

<h2 id="run">RUN</h2>

<ul>
<li>作用

<ul>
<li>于 <code>Docker</code> 新层中中执行脚本

<ul>
<li><code>RUN</code> 的缓存不会在下一步构建操作中自动失效

<ul>
<li><code>RUN apt-get dist-upgrade -y</code> 可于下一步构建中重用</li>
<li><code>docker build --no-cache</code> 构建中使用 <code>--no-cache</code> 排除 <code>RUN</code> 构建中的缓存影响</li>
</ul></li>
</ul></li>
<li>执行命令并 <strong>创建新镜像层</strong>，经常用于 <strong>安装软件包</strong></li>
</ul></li>
<li>指令

<ul>
<li><code>RUN [[&lt;shell&gt;] &lt;command&gt;|[[&lt;shell&gt;,]&quot;&lt;command&gt;&quot;, &quot;&lt;args...&gt;&quot;]]</code></li>
</ul></li>
<li>使用

<ul>
<li><code>RUN /bin/bash -c 'source $HOME/.bashrc; echo $HOME'</code></li>
<li><code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code></li>
<li><code>RUN [&quot;echo&quot;, &quot;$HOME&quot;]</code>

<ul>
<li>相较下例，不会将 <code>$HOME</code>变量 <strong>替换为实际值</strong></li>
</ul></li>
<li><code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo $HOME&quot;]</code></li>
</ul></li>
</ul>

<h2 id="cmd">CMD</h2>

<ul>
<li>作用

<ul>
<li>执行版本，目的于提供运行容器的默认启动语句或入口点

<ul>
<li><code>Dockerfile</code> 仅执行一次 <code>CMD</code> 语句

<ul>
<li>存在多条指令的情况， <strong>执行最后一条</strong></li>
</ul></li>
<li>支持 <code>ENTRYPOINT</code> 情况下，需指定 <code>JSON</code> 数组格式</li>
</ul></li>
<li>设置容器启动后，默认执行的命令及参数

<ul>
<li>可被 <code>docker run</code> 语句后的命令行参数 <strong>替换</strong></li>
</ul></li>
</ul></li>
<li>指令

<ul>
<li><code>CMD [[&lt;shell&gt;] &lt;command&gt;|[[&lt;shell&gt;,]&quot;&lt;command&gt;&quot;, &quot;&lt;args...&gt;&quot;]]</code></li>
</ul></li>
<li>使用

<ul>
<li><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</code>

<ul>
<li>执行模式，推荐

<ul>
<li>执行不调用命令解析器，导致正常脚本执行无法正常运行

<ul>
<li><code>CMD [ &quot;echo&quot;, &quot;$HOME&quot; ]</code> 中 <code>$HOME</code> 将不会被替换</li>
<li>可使用 <code>脚本模式</code> 或 <code>CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]</code> 方式实现</li>
</ul></li>
</ul></li>
</ul></li>
<li><code>CMD [&quot;param1&quot;,&quot;param2&quot;]</code>

<ul>
<li><code>ENTRYPOINT</code> 使用情况</li>
</ul></li>
<li><code>CMD command param1 param2</code>

<ul>
<li>脚本模式</li>
<li>linux 默认使用 <code>/bin/sh -c</code>，windows 默认使用 <code>cmd /S /C</code></li>
</ul></li>
</ul></li>
</ul>

<h2 id="label">LABEL</h2>

<ul>
<li>作用

<ul>
<li>为镜像添加标签信息</li>
</ul></li>
<li>指令

<ul>
<li><code>LABEL ( &lt;key&gt;=&lt;value&gt;)+</code></li>
</ul></li>
<li>使用

<ul>
<li>添加标签
<code>Docker
LABEL version=&quot;1.0&quot;
LABEL description=&quot;This text illustrates \
        that label-values can span multiple lines.&quot;
</code></li>
<li>查看标签

<ul>
<li><code>docker inspect &lt;image.name&gt;</code>
<code>Docker
&quot;Labels&quot;: {
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;description&quot;: &quot;This text illustrates that label-values can span multiple lines.&quot;,
},    
</code></li>
</ul></li>
</ul></li>
</ul>

<h2 id="maintainer"><del>MAINTAINER</del></h2>

<ul>
<li>作用

<ul>
<li>为镜像添加作者信息</li>
</ul></li>
<li>指令

<ul>
<li><code>MAINTAINER &lt;name&gt;</code></li>
</ul></li>
<li>使用

<ul>
<li>建议使用 <code>LABEL</code> 代替

<ul>
<li><code>LABEL maintainer=&quot;docker@gmail.com&quot;</code></li>
</ul></li>
</ul></li>
</ul>

<h2 id="expose">EXPOSE</h2>

<ul>
<li>作用

<ul>
<li><strong>声明</strong> 容器服务监听的特定网络 <strong>端口</strong></li>
</ul></li>
<li>指令

<ul>
<li><code>EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</code>

<ul>
<li>协义支持 <code>TCP</code> 和 <code>UCP</code>

<ul>
<li>默认为 <code>TCP</code></li>
</ul></li>
<li>仅声明占用端口，实际开放请参考 <code>docker run</code> 的 <code>-p</code> 标签</li>
</ul></li>
</ul></li>
<li>使用

<ul>
<li><code>EXPOSE 80/tcp</code></li>
</ul></li>
</ul>

<h2 id="add">ADD</h2>

<ul>
<li>作用

<ul>
<li>将指定的文件、目录或 <strong>远程文件</strong> 拷贝至镜像文件系统中的相对位置</li>
</ul></li>
<li>指令

<ul>
<li><code>ADD [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code>

<ul>
<li><code>[--chown=&lt;user&gt;:&lt;group&gt;]</code> 仅于 Linux 操作系统中有效

<ul>
<li>将该文件或文件夹指定给指定的用户名、级名或 UID/GID 组合

<ul>
<li>默认指定给 UID= GID= 0</li>
<li>通过 <code>/etc/passwd</code> 和 <code>/etc/group</code> 将用户名、级名转换为 <code>UID</code> 和 <code>GID</code></li>
</ul></li>
</ul></li>
<li>仅能 <strong>拷贝构建上下文中</strong> 的数据，且针对目录只 <strong>拷贝目录内内容</strong> 而不包括文件夹本身</li>
</ul></li>
</ul></li>
<li>使用
<code>Docker
ADD hom* /dest/                 # 将以 `hom` 开头的文件都拷贝至 `/dest/`
ADD --chown=bin files* /dest/   # 将以 `files` 开头的文件均垧上至 `/dest/`，并授权给 `bin:bin` 用户
ADD test dest/                  # 将 `test` 文件拷贝至 `WORKDIR`/dest/
ADD test /dest/                 # 将 `test` 文件拷贝至 `/dest/ `
</code></li>
</ul>

<h2 id="copy">COPY</h2>

<ul>
<li>作用

<ul>
<li>将指定的文件、目录拷贝至镜像文件系统中的相对位置</li>
</ul></li>
<li>指令

<ul>
<li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code>

<ul>
<li>与 <code>ADD</code> 基本相同

<ul>
<li>较之不支持 <strong>远程文件</strong></li>
<li>较之支持将可识别的压缩格式（tar/ gzip/ bzip2/ etc）源文件， <strong>自动解压</strong> 至指定目录</li>
</ul></li>
</ul></li>
</ul></li>
<li>使用

<ul>
<li>参照 <code>ADD</code></li>
</ul></li>
</ul>

<h2 id="entrypoint">ENTRYPOINT</h2>

<ul>
<li>作用

<ul>
<li>配置容器启动时运行的命令</li>
<li>容器启动需 <code>CMD</code> 和 <code>ENTRYPOINT</code> 中任意一个</li>
</ul></li>
<li>指令

<ul>
<li><code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</code>

<ul>
<li>执行模式</li>
<li><code>docker run</code> 的参数将于 <code>ENTRYPOINT</code> 后追加，并覆盖元素</li>
</ul></li>
<li><code>ENTRYPOINT command param1 param2</code>

<ul>
<li>脚本模式</li>
<li>阻止 <code>CMD</code> 和 <code>RUN</code> 中的命令行参数被使用</li>
<li>默认以 <code>/bin/sh -c</code> 形式运行，导致无法正常地接收 <code>docker stop</code> 的信号</li>
</ul></li>
</ul></li>
<li>使用
|                   |        NULL       | ENTRYPOINT entry v1 | ENTRYPOINT [&ldquo;entry&rdquo;, &ldquo;v1&rdquo;] |
|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;|&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-|
| NULL              | ERROR             | /bin/sh -c entry v1 | entry v1                   |
| CMD [&ldquo;cmd&rdquo;, &ldquo;c1&rdquo;] | cmd c1            | /bin/sh -c entry v1 | entry v1 cmd c1            |
| CMD [&ldquo;c1&rdquo;, &ldquo;c2&rdquo;]  | c1 c2             | /bin/sh -c entry v1 | entry v1 c1 c2             |
| CMD cmd c1        | /bin/sh -c cmd c1 | /bin/sh -c entry v1 | entry v1 /bin/sh -c cmd c1 |</li>
</ul>

<h2 id="volume">VOLUME</h2>

<ul>
<li>作用

<ul>
<li>指定挂载的主机目录</li>
</ul></li>
<li>指令

<ul>
<li><code>VOLUME [&quot;/data&quot;]</code>

<ul>
<li>Windows 情况下，需指定 <strong>C盘外</strong> 的 <strong>不存在或空</strong> 的文件夹</li>
<li>目录数据改变的操作需 <strong>于声明之前</strong></li>
<li>无法指定主机上的对应目录，由 <strong>系统自动生成</strong></li>
</ul></li>
</ul></li>
<li>使用

<ul>
<li><code>VOLUME [&quot;/var/log&quot;, &quot;/var/db&quot;]</code>

<ul>
<li>JSON 形式，以「&rdquo;」包围，以「,」分隔</li>
</ul></li>
<li><code>VOLUME /var/log /var/db</code>

<ul>
<li>Plain String 形式，以「空格」分隔</li>
</ul></li>
</ul></li>
<li>对比

<ul>
<li><code>docker run -v /data:/app</code></li>
<li><code>docker run --volumes-from &lt;image.id&gt;</code>
<br /></li>
</ul></li>
</ul>

<h2 id="user">USER</h2>

<ul>
<li>作用

<ul>
<li>用于指定镜像运行或 <code>RUN/ CMD/ ENTRYPOINT</code> 的用户[群组]</li>
</ul></li>
<li>指令

<ul>
<li><code>USER &lt;user|UID&gt;[:&lt;group|GID&gt;]</code>

<ul>
<li>当用户未配置组的情况下，默认以 <code>root</code> 群组名义</li>
<li>Windows 环境下，用户需先行创建</li>
</ul></li>
</ul></li>
</ul>

<h2 id="workdir">WORKDIR</h2>

<ul>
<li>作用

<ul>
<li>为 <code>RUN/ CMD/ ENTRYPOINT/ COPY/ ADD</code> 等指令指定工作目录</li>
</ul></li>
<li>指令

<ul>
<li><code>WORKDIR &lt;/path/to/workdir&gt;</code>

<ul>
<li>多次使用情况下，均以上一命令结果作为 <strong>相对目录</strong></li>
</ul></li>
</ul></li>
</ul>

<h2 id="arg">ARG</h2>

<ul>
<li>作用

<ul>
<li>运行时传入参数

<ul>
<li>构建时以 <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> 形式传入</li>
</ul></li>
</ul></li>
<li>指令

<ul>
<li><code>ARG &lt;name&gt;[=&lt;default value&gt;]</code></li>
</ul></li>
<li>使用

<ul>
<li><p>定义</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> busybox</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>USER <span style="color:#e6db74">${</span>user<span style="color:#66d9ef">:-</span>some_user<span style="color:#e6db74">}</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>ARG user<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># ARG.user.defaultValue= some_user, realValue= what_user</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>USER $user        </code></pre></div></li>

<li><p>构建</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">docker build --build-arg user<span style="color:#f92672">=</span>what_user .</code></pre></div></li>
</ul></li>
</ul>

<h2 id="shell">SHELL</h2>

<ul>
<li>作用

<ul>
<li>指定默认执行的脚本编译器</li>
</ul></li>
<li>指令

<ul>
<li><code>SHELL [&quot;powershell&quot;, &quot;-command&quot;]</code></li>
<li><code>SHELL [&quot;cmd&quot;, &quot;/S&quot;, &quot;/C&quot;]</code></li>
</ul></li>
</ul>

<h1 id="dockerignore">Dockerignore</h1>

<table>
<thead>
<tr>
<th>规则</th>
<th>行为</th>
</tr>
</thead>

<tbody>
<tr>
<td>#comment</td>
<td>注释</td>
</tr>

<tr>
<td><em>/temp</em></td>
<td>根目录下任何以 <code>temp</code> 开头的文件或目录都将被排除<br>例如 <code>/somedir/temporary.txt</code> 文件和 <code>/somedir/temp</code> 文件夹都将被过滤</td>
</tr>

<tr>
<td><em>/</em>/temp*</td>
<td>根目录下第三层任意以 <code>temp</code> 开头的文件或目录都将被排除<br>例如 <code>/somedir/subdir/temporary.txt</code></td>
</tr>

<tr>
<td>temp?</td>
<td>根目录下任意以 <code>temp</code> 开头，相差以一个字符的文件或目录都将被排除<br>例如 <code>/tempa and</code> 和 <code>/tempb</code></td>
</tr>

<tr>
<td>!README.md</td>
<td>排除例外情况</td>
</tr>
</tbody>
</table>

<h1 id="example">Example</h1>

<h2 id="basic">Basic</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#75715e"># 以镜像 `ubuntu:15.04` 为基础进行封装</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> ubuntu:15.04</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 将当前目录文件拷贝至 `Docker` 客户端文件夹中</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>COPY . /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 执行命令，编译文件</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> make /app<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># 指定在容器内运行，启动服务</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span><span style="color:#e6db74"> python /app/app.py</span></code></pre></div>
<h2 id="basic-windows">Basic.Windows</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#75715e"># 将转义字符设置为 `，便于在路径描述中正常使用 \ </span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># escape=`</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> microsoft/nanoserver</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>COPY testfile.txt c:<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>RUN dir c:<span style="color:#960050;background-color:#1e0010">\</span></code></pre></div>
<h2 id="variable">Variable</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Docker" data-lang="Docker"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> busybox</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> foo /bar</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> abc=hello           # abc= hello</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> abc=bye def=$abc    # abc= bye; def= hello</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span><span style="color:#e6db74"> ghi=$abc            # ghi= hello</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> ${foo}          # WORKDIR /bar</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span><span style="color:#e6db74"> . $foo              # ADD . /bar</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>COPY <span style="color:#ae81ff">\$</span>foo /quux        # COPY $foo /quux</code></pre></div>
<h2 id="build-multiple">Build.Multiple</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Docker" data-lang="Docker">ARG  CODE_VERSION<span style="color:#f92672">=</span>latest        # 唯一可以列于 FROM 之前的结构<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> base:${CODE_VERSION}</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span><span style="color:#e6db74">  /code/run-app</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> extras:${CODE_VERSION}</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span><span style="color:#e6db74">  /code/run-extras    </span></code></pre></div>
<h2 id="basic-run">Basic.Run</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Docker" data-lang="Docker"><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /a</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> b</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> c</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> pwd          # ./a/b/c/pwd</code></pre></div>
<h1 id="reference">Reference</h1>

<h2 id="官方">官方</h2>

<ul>
<li><a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference</a></li>
<li><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">Best practices for writing Dockerfiles</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">.dockerignore file</a></li>
</ul>

<h2 id="整理">整理</h2>

<ul>
<li><a href="https://itbilu.com/linux/docker/VyhM5wPuz.html">Docker镜像构建文件Dockerfile及相关命令介绍</a></li>
<li><a href="http://dockone.io/article/103">Docker入门教程（三）Dockerfile</a></li>
<li><a href="https://www.toutiao.com/i6313838452630618626/">Dockerfile: ADD vs COPY</a></li>
<li><a href="https://www.ibm.com/developerworks/community/blogs/132cfa78-44b0-4376-85d0-d3096cd30d3f/entry/RUN_vs_CMD_vs_ENTRYPOINT_%E6%AF%8F%E5%A4%A95%E5%88%86%E9%92%9F%E7%8E%A9%E8%BD%AC_Docker_%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF_17?lang=en">每天5分钟玩转 OpenStack</a></li>
<li><a href="https://www.cnblogs.com/51kata/p/5266626.html">docker学习笔记18：Dockerfile 指令 VOLUME 介绍</a></li>
</ul>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="http://domain.yqjdcyy.com/tags/docker" rel="tag" title="Docker">#Docker#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="http://domain.yqjdcyy.com/post/linux.java/" rel="next" title="Linux.Java">
        <i class="fa fa-chevron-left"></i> Linux.Java
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="http://domain.yqjdcyy.com/post/hello.docker.compose/" rel="prev" title="Hello.Docker.Compose">
        Hello.Docker.Compose <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     <div class="post-nav">
    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
        <div>
            <p style="margin-top:0px;">
                标题：Hello.Docker.Dockerfile
                <br />作者：
                <a target="_blank" href="http://domain.yqjdcyy.com/">好久不见</a>
                <br />关注：好久不见
                <br />声明：自由转载-非商用-非衍生-保持署名（创作共享3.0许可证）
            </p>
        </div>
    </div>
    <div class="clear"></div>
</div>
     
     
     




    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

  <ul class="sidebar-nav motion-element">
    <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
      文章目录
    </li>
    <li class="sidebar-nav-overview" data-target="site-overview">
      站点概览
    </li>
  </ul>

    <section class="site-overview sidebar-panel ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="http://domain.yqjdcyy.com/img/profile-image.png"
        alt="好久不见" />
    <p class="site-author-name" itemprop="name">好久不见</p>
    <p class="site-description motion-element" itemprop="description"> 
        Have fun~</p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="http://domain.yqjdcyy.com/post/">
        <span class="site-state-item-count">240</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="http://domain.yqjdcyy.com/categories/">      
         
        <span class="site-state-item-count">9</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="http://domain.yqjdcyy.com/tags/">
         
        <span class="site-state-item-count">120</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/yqjdcyy" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>

      
      <div class="links-of-blogroll motion-element inline">
    <script type="text/javascript" src="//ra.revolvermaps.com/0/0/8.js?i=04ljtqzk00r&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=1"
        async="async"></script>
</div>
    </section>
    
<section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
    <div class="post-toc">
        <div class="post-toc-content"><nav id="TableOfContents">
<ul>
<li><a href="#work">Work</a></li>
<li><a href="#guidlines">Guidlines</a></li>
<li><a href="#command">Command</a>
<ul>
<li><a href="#parser-directives">Parser directives</a></li>
<li><a href="#env">ENV</a></li>
<li><a href="#from">FROM</a></li>
<li><a href="#run">RUN</a></li>
<li><a href="#cmd">CMD</a></li>
<li><a href="#label">LABEL</a></li>
<li><a href="#maintainer"><del>MAINTAINER</del></a></li>
<li><a href="#expose">EXPOSE</a></li>
<li><a href="#add">ADD</a></li>
<li><a href="#copy">COPY</a></li>
<li><a href="#entrypoint">ENTRYPOINT</a></li>
<li><a href="#volume">VOLUME</a></li>
<li><a href="#user">USER</a></li>
<li><a href="#workdir">WORKDIR</a></li>
<li><a href="#arg">ARG</a></li>
<li><a href="#shell">SHELL</a></li>
</ul></li>
<li><a href="#dockerignore">Dockerignore</a></li>
<li><a href="#example">Example</a>
<ul>
<li><a href="#basic">Basic</a></li>
<li><a href="#basic-windows">Basic.Windows</a></li>
<li><a href="#variable">Variable</a></li>
<li><a href="#build-multiple">Build.Multiple</a></li>
<li><a href="#basic-run">Basic.Run</a></li>
</ul></li>
<li><a href="#reference">Reference</a>
<ul>
<li><a href="#官方">官方</a></li>
<li><a href="#整理">整理</a></li>
</ul></li>
</ul>
</nav></div>
    </div>
</section>

  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2018</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">好久不见</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.30.2</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="http://domain.yqjdcyy.com/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="http://domain.yqjdcyy.com/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/utils.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/motion.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/affix.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/schemes/pisces.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/scrollspy.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/post-details.js"></script>
<script type="text/javascript" src="http://domain.yqjdcyy.com/js/toc.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/bootstrap.js"></script>

<script type="text/javascript" src="http://domain.yqjdcyy.com/js/search.js"></script>
</body>
</html>